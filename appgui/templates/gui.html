<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TextFSM Parser</title>
  <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    /> -->
  <link href="/static/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/static/css/codemirror.css" />
  <link rel="stylesheet" href="/static/css/shadowfox.css" />
  <link rel="stylesheet" href="/static/css/parseatron.css?ver=123" />
  <script src="/static/js/jquery.min.js"></script>
  <script src="/static/js/codemirror.js"></script>
  <script src="/static/mode/yaml/yaml.js"></script>
  <script src="/static/mode/jinja2/jinja2.js"></script>
  <script src="/static/mode/python/python.js"></script>
  <script src="/static/mode/xml/xml.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">TextFSM Parser</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
              data-bs-toggle="dropdown" aria-expanded="false">
              Templates
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
              {% if obj %} {% for model in obj %}
              <li class="dropdown-item template_id" value="{{model.id}}">id: {{model.id}} sub_id: {{model.sub_id}}</li>
              {% endfor %} {% else %}
              <li class="dropdown-item">No templates found in database</li>
              {% endif %}
            </ul>
          </li>
        </ul>
      </div>
      <span> Header Mode &nbsp;</span>
      <span><input id="fsmmode" type="checkbox"></span>
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row gx1">
      <div class="split">
        <div id="split-0">
          <div class="editor" id="text_textarea">
            <textarea id="text_input" type="text" v-model="cli_text">
              </textarea>
          </div>
        </div>
        <div id="split-1">
          <div class="editor" id="template_textarea">
            <textarea id="template" v-model="message"> </textarea>
          </div>
        </div>
        <div id="split-2">
          <div class="editor" id="result_textarea">
            <textarea id="result" v-model="message"> </textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/js/split.js"></script>
  <script src="/static/js/javascript.js"></script>
  <script src="/static/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="/static/js/parser.js"></script> -->
  <script>
    let selected_mode = "textfsm";
    let split_size = 2;

    document.getElementById("text_input").value = "Enter your CLI text here";
    document.getElementById(
      "template"
    ).value = `And your ${selected_mode} template here`;
    document.getElementById("result").value = `View your result here`;

    var txt_area = document.getElementById("text_input");
    var text_editor = CodeMirror.fromTextArea(txt_area, {
      lineNumbers: true,
      theme: "shadowfox",
      matchBrackets: true,
      mode: "text",
      indentWithTabs: true,
      tabMode: "indent",
      indentUnit: 0,
      delay: { show: 500, hide: 100 },
    });

    var template_area = document.getElementById("template");
    var template_editor = CodeMirror.fromTextArea(template_area, {
      lineNumbers: true,
      theme: "shadowfox",
      mode: "text",
      indentWithTabs: true,
      tabMode: "indent",
      indentUnit: 0,
      delay: { show: 500, hide: 100 },
    });

    var result_area = document.getElementById("result");
    var result_editor = CodeMirror.fromTextArea(result_area, {
      lineNumbers: true,
      theme: "shadowfox",
      mode: "javascript",
      indentWithTabs: true,
      tabMode: "indent",
      indentUnit: 0,
      delay: { show: 300, hide: 100 },
      readOnly: true,
    });

    text_editor.on("change", (e) => {
      const template_text = template_editor.doc.getValue();
      const cli_text = text_editor.getDoc().getValue();
      $.ajax({
        type: "POST",
        url: `/api/${selected_mode}/`,
        data: { inputtext: cli_text, fsmtxt: template_text,fsmmode:document.getElementById("fsmmode").checked },
        headers: { "X-CSRFToken": "{{csrf_token}}" },
        success: function (result) {
          var jsonPretty = JSON.stringify(result, null, "\t");
          result_editor.getDoc().setValue(jsonPretty);
        },
      });
    });

    template_editor.on("change", () => {
      const template_text = template_editor.doc.getValue();
      const cli_text = text_editor.getDoc().getValue();
      $.ajax({
        type: "POST",
        url: `/api/${selected_mode}/`,
        data: { inputtext: cli_text, fsmtxt: template_text,fsmmode: document.getElementById("fsmmode").checked },
        headers: { "X-CSRFToken": "{{csrf_token}}" },
        success: function (result) {
          var jsonPretty = JSON.stringify(result, null, "\t");
          result_editor.getDoc().setValue(jsonPretty);
        },
      });
    });
    document.getElementById("fsmmode").onchange= function() {
      console.log("fsmmode chnage")
      const template_text = template_editor.doc.getValue();
      const cli_text = text_editor.getDoc().getValue();
      $.ajax({
        type: "POST",
        url: `/api/${selected_mode}/`,
        data: { inputtext: cli_text, fsmtxt: template_text,fsmmode: document.getElementById("fsmmode").checked },
        headers: { "X-CSRFToken": "{{csrf_token}}" },
        success: function (result) {
          var jsonPretty = JSON.stringify(result, null, "\t");
          result_editor.getDoc().setValue(jsonPretty);
        },
      });
    };
  

    function doSplit(split_array) {
      if (split_size != split_array.length) {
        $(".gutter-horizontal").remove();
        Split(split_array, {
          gutterSize: 4,
        });
        split_size = split_array.length;
      }
    }

    function setParseMode(mode) {
      var split_js = undefined;
      selected_mode = mode;
      template_editor
        .getDoc()
        .setValue(`And your ${selected_mode} template here`);
      template_editor.setOption("readOnly", false);

      if (selected_mode == "textfsm") {
        $("#split-1").show();
        $("#template_textarea").show();
        text_editor.getDoc().setValue(`Enter your CLI here`);
        result_editor.getDoc().setValue(`View your rendered data here`);
        text_editor.setOption("mode", "text");
        template_editor.setOption("mode", "text");
        doSplit(["#split-0", "#split-1", "#split-2"]);
      }
    }
  </script>
  <script>
    setParseMode("textfsm");
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Get all elements with the class 'nav-link'
      var navLinks = document.querySelectorAll(".template_id");

      // Loop through each nav link and add a click event listener
      navLinks.forEach(function (link) {
        link.addEventListener("click", function (event) {
          // Prevent default link behavior
          event.preventDefault();
          $.ajax({
            type: "POST",
            url: "/api/get-template/",
            data: { template_id: link.value },
            headers: { "X-CSRFToken": "{{csrf_token}}" },
            success: function (result) {
              template_editor.getDoc().setValue(result.template);
              text_editor.getDoc().setValue(result.text);


            },
          });

          // For example, you can add additional actions such as navigation or displaying content
        });
      });
    });
  </script>

  <!-- Add your other scripts and inline scripts here -->
</body>

</html>